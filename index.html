<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <title>&Team sort</title>
  <meta http-equiv="Content-Style-Type" content="text/css">
  <meta http-equiv="Content-Script-Type" content="text/javascript">
  <style type="text/css">
    #mainTable {
      font-size: 12px;
      font-family: '돋움', sans-serif;
      text-align: center;
      vertical-align: middle;
      width: 410px;
      margin-left: auto;
      margin-right: auto;
      border-collapse: separate;
      border-spacing: 10px 5px;
    }
    #leftField, #rightField {
      width: 120px;
      height: 150px;
      border: 1px solid #000;
    }
    .middleField {
      width: 120px;
      height: 70px;
      border: 1px solid #000;
    }
    a { text-decoration: none; }
    a:hover { color: #99ccff; }
  </style>
</head>

<body text="#000000" bgcolor="#ffffff" link="#0099ff" vlink="#0099ff" alink="#0099ff">
  <table id="mainTable" align="center">
    <tr>
      <td id="battleNumber" colspan="3" style="padding-bottom: 10px;"><p>&nbsp;</p></td>
    </tr>
    <tr>
      <td id="leftField" onclick="if(finishFlag==0)sortList(-1);" rowspan="2">&nbsp;</td>
      <td class="middleField" onclick="if(finishFlag==0)sortList(0);">둘 다 좋다</td>
      <td id="rightField" onclick="if(finishFlag==0)sortList(1);" rowspan="2"></td>
    </tr>
    <tr>
      <td class="middleField" onclick="if(finishFlag==0)sortList(0);">모르겠다</td>
    </tr>
  </table><br><br>

  <div id="resultField" style="text-align:center;">
    <p><font size="2" face="돋움"><span>(ONE TWO) We Link! こんにちは、&TEAMです!</span></font></p>
  </div>

  <script type="text/javascript">
    var namMember = [
      "<img src='https://via.placeholder.com/80'><br>K",
      "<img src='https://via.placeholder.com/80'><br>FUMA",
      "<img src='https://via.placeholder.com/80'><br>EJ",
      "<img src='https://via.placeholder.com/80'><br>NICHOLAS",
      "<img src='https://via.placeholder.com/80'><br>YUMA",
      "<img src='https://via.placeholder.com/80'><br>JO",
      "<img src='https://via.placeholder.com/80'><br>HARUA",
      "<img src='https://via.placeholder.com/80'><br>TAKI",
      "<img src='https://via.placeholder.com/80'><br>MAKI"
    ];

    var lstMember = [], parent = [], equal = [], rec = [];
    var cmp1, cmp2, head1, head2, nrec;
    var numQuestion, totalSize, finishSize, finishFlag;

    function initList() {
      var n = 0, mid;
      lstMember[n] = namMember.map((_, i) => i);
      parent[n] = -1;
      totalSize = 0;
      n++;

      for (let i = 0; i < lstMember.length; i++) {
        if (lstMember[i].length >= 2) {
          mid = Math.ceil(lstMember[i].length / 2);
          lstMember[n] = lstMember[i].slice(0, mid);
          totalSize += lstMember[n].length;
          parent[n++] = i;

          lstMember[n] = lstMember[i].slice(mid);
          totalSize += lstMember[n].length;
          parent[n++] = i;
        }
      }

      rec = new Array(namMember.length).fill(0);
      equal = new Array(namMember.length + 1).fill(-1);
      nrec = 0;

      cmp1 = lstMember.length - 2;
      cmp2 = lstMember.length - 1;
      head1 = head2 = 0;
      numQuestion = 1;
      finishSize = 0;
      finishFlag = 0;
    }

    function sortList(flag) {
      if (flag < 0) {
        record(lstMember[cmp1][head1++]);
      } else if (flag > 0) {
        record(lstMember[cmp2][head2++]);
      } else {
        let l = lstMember[cmp1][head1++];
        record(l);
        equal[l] = lstMember[cmp2][head2];
        record(lstMember[cmp2][head2++]);
      }

      if (head1 === lstMember[cmp1].length && head2 === lstMember[cmp2].length) {
        for (let i = 0; i < lstMember[cmp1].length + lstMember[cmp2].length; i++) {
          lstMember[parent[cmp1]][i] = rec[i];
        }
        lstMember.pop();
        lstMember.pop();
        cmp1 -= 2;
        cmp2 -= 2;
        head1 = head2 = 0;
        rec = new Array(namMember.length).fill(0);
        nrec = 0;
      }

      if (cmp1 < 0) {
        document.getElementById("battleNumber").innerHTML = `Battle No.${numQuestion - 1}<br>${Math.floor(finishSize * 100 / totalSize)}% sorted.`;
        showResult();
        finishFlag = 1;
      } else {
        showImage();
      }
    }

    function record(index) {
      rec[nrec++] = index;
      finishSize++;
      while (equal[index] !== -1) {
        index = equal[index];
        rec[nrec++] = index;
        finishSize++;
      }
    }

    function showResult() {
      let ranking = 1, sameRank = 1, str = "";
      str += "<table style='width:200px; font-size:12px; line-height:120%; margin:auto; border:1px solid #000; border-collapse:collapse'>";
      str += "<tr><td style='color:#fff; background:#000; text-align:center;'>순위</td><td style='color:#fff; background:#000; text-align:center;'>이름</td></tr>";

      for (let i = 0; i < namMember.length; i++) {
        str += `<tr><td style='border:1px solid #000; text-align:right;'>${ranking}</td><td style='border:1px solid #000;'>${namMember[lstMember[0][i]]}</td></tr>`;
        if (i < namMember.length - 1 && equal[lstMember[0][i]] === lstMember[0][i + 1]) {
          sameRank++;
        } else {
          ranking += sameRank;
          sameRank = 1;
        }
      }

      str += "</table>";
      document.getElementById("resultField").innerHTML = str;
    }

    function showImage() {
      let str0 = `Battle No.${numQuestion}<br>${Math.floor(finishSize * 100 / totalSize)}% sorted.`;
      let str1 = toNameFace(lstMember[cmp1][head1]);
      let str2 = toNameFace(lstMember[cmp2][head2]);

      document.getElementById("battleNumber").innerHTML = str0;
      document.getElementById("leftField").innerHTML = str1;
      document.getElementById("rightField").innerHTML = str2;
      numQuestion++;
    }

    function toNameFace(n) {
      return namMember[n];
    }

    initList();
    showImage();
  </script>
</body>
</html>
